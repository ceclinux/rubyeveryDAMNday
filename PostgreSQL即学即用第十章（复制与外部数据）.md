`PostgreSQL`有很多方法可以实现与外部数据源之间的数据共享。第一种就是`PostgreSQL`自带的复制功能，通过该功能可以在令哇一台服务器上创建出当前服务器的一个镜像。第二种方法是使用第三方插件，其中许多插件可以免费使用，并且其可靠性也是就近考研的。第三种方法是外部数据封装器(Foreign Data Wrapper, FDW)。`FDW`支持大量的外部数据源，有些FDW，比如(`postgres_fdw`和`hadoop_fdw`)也支持对外部数据的修改。

全世界的客户都涌到你的网站来查看并购买，有与流量过大导致网站过载并无法正常处理请求，那么这时候就需要复制功能出马了。只需设定一个只读的丛书服务器作为主服务器的镜像，然后就可以把海量的读请求分流到丛书服务器上，只有当买家真正下单时才需要到主服务器上进行操作。

## 复制功能涉及的术语

- 主服务器
主服务器是作为复制数据源头的数据库服务器，所有的更新都在其上发生。使用`PostgreSQL`的内置功能时，仅允许使用一个主服务器。

- 从属服务器
从属服务器使用复制的数据并提供主服务器的副本。尽管有人谈到一些听起来更悦耳的术语。比如：订阅者(`subscriber`)，代理(`agent`)等，但从属服务器这个名称仍然是最贴切的。

- 预写日志(`Write Ahead Log`)， WAL
WAL就是就是记录所有已完成事务信息的日志文件，在其他数据库产品中一般称为事务日志。为了支持复制功能，`PostgreSQL`将主服务器的`WAL`日志向丛书服务器开放，然后丛书服务器持续地将这些日志取到本地，然后将其中记录的事务重演一遍，这样就实现了数据同步。

- 同步复制
在事务提交阶段，`PostgreSQL`需保证已经将此事务中所做的修改成功同步到至少一个从属服务器，然后才能向用户反馈事务提交成功。这种工作模式保证了主服务器和从属服务器的数据在同一个事务内被同步修改，因此被称为同步复制。如果配置了多个从属服务器，只要写入一个成功就算提交成功。

- 异步复制

在事务提交阶段，主服务器上提交成功就算成功，不需要等待从属服务器的数据跟新成功。当从属服务器位于远端时该模式就比较有用了，因为可以避免网络的影响。但有利必有弊，该模式下从属服务器的数据更新不够及时，与主服务器之间会有一些延迟。当传输失败时，从属服务器可能会丢失一些数据。

- 流式复制

从PG 9.0版本开始支持流式复制。在此前的版本中，`WAL`日志是通过直接复制文件的方式从主服务器传递到从属服务器，但在流式复制模式下是通过消息来传递的。
